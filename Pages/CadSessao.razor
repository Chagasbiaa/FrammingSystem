@page "/CadSessao"
@using System;
@using System.Net.Http;
@using System.Text;
@using System.Text.Json;
@using System.Threading.Tasks;

@inject IHttpClientFactory ClientFactory

<PageTitle>Counter</PageTitle>


<div class="container_pesquisa">
            <button id="button_home">
                <a href="ferqyfq.html">
                    <img src="~/Content/images/icon_home.png">
                </a>
            </button>

            <button id="button_notificacao">
                <a href="ferqyfq.html">
                    <img src="~/Content/images/icon_notificacao.png">
                </a>

            </button>

            <div id="div_identificacao">
                <img src="~/Content/images/Chagasperfil.png">
                <p>Beatriz Chagas</p>
                <div id="div_indifica_role">
                    <p>Linda</p>
                </div>
            </div>

            <div id="divBusca">
                <input type="text" id="txtBusca" img src="~/Content/images/lupapesquisa.png">
                <img id="imgBusca" src="~/Content/images/lupapesquisa.png" width="30px" alt="Buscar">
            </div>
        </div>
        

        <div class="container_menu_content">
            <div class="container_menu">
                <nav class="menu">
                    <img id="framming_logo_menu" src="~/Content/images/framminglogo.png" />
                    <ul>
                        <div class="menu_container">
                            <button id="button_cliente_menu">
                        <li><a href="cad_func"><img src="~/Content/images/icon_cliente.png"></a></li></button>
                        <button id="button_mensagens_menu">
                        <li><a href="Verpostadm"><img src="~/Content/images/icon_mensagens.png"></a></li></button>
                        <button id="button_identificacao_menu">
                        <li><a href="#"><img src="~/Content/images/icon_identificacao.png"></a></li></button>
                        <button id="button_theater_menu">
                        <li><a href="Cad_cinema"><img src="~/Content/images/theater.png"></a></li></button>
                  </div>
            </ul>
            <ul>
                <div class="buttons_sair_configuracao">
                    <button id="button_sair_menu">
                <li><a href="#"><img src="~/Content/images/icon_saida.png"></a></li></button>
                <button id="button_configuracao_menu">
                <li><a href="#"><img src="~/Content/images/configuracao.png"></a></li></button>
        </div>
        </ul>
        </nav>

        </div>
        <div class="container_content">
            <div class="container_main">
                <div class="codigo_cinema">
                    <img id="foto_codigo_func" src="~/Content/images/icon_identifica_func.png" />
                    <p id="cod_cinema_p">Código Cinema: @Input.Filme</p>
                    <p id="cod_nome_p">Nome: @Input.Data</p>
                    <p id="cod_email_p">Email: @Input.Horario</p>
                    <p id="cod_senha_p">Senha: @Input.qtsingresso</p>
                     <p id="cod_senha_p">Senha: @Input.Salasessao</p>
                </div>

                <p id="codigo_cadastro_func_p">Cadastro de Funcionário</p>


                <p id="codigo_func_p">Filme:</p>
                <p id="codigo_func_result"></p>
                <input @bind="@Input.Filme" id="codigo_func" type="text" placeholder="0000">
                <img id="codigo_func_img" src="~/Content/images/icon_codigo.png" width="35px">

                <p id="codigo_nome_p">Data:</p>
                <p id="codigo_nome_result"></p>
                <input @bind="@Input.Data" id="nome_func" type="text" placeholder="Nome" />
                <img id="nome_func_img" src="~/Content/images/icon_theater.png" width="35px">

                <p id="codigo_email_p">Horário:</p>
                <p id="codigo_email_result"></p>
                <input @bind="@Input.Horario" id="email_func" type="text" placeholder="exemplo@email.com" />
                <img id="email_func_img" src="~/Content/images/icon_email.png" width="35px">

                <p id="codigo_senha_p">Quantidade de ingresso:</p>
                <p id="codigo_senha_result"></p>
                <input @bind="@Input.qtsingresso" id="senha_func" type="text" placeholder="*******" />
                <img id="senha_func_img" src="~/Content/images/icon_chave.png" width="35px">

                <p id="codigo_Confime_p">Sala da Sessão:</p>
                <input @bind="@Input.Salasessao"id="confirma_senha_func" type="text" img src="img/lupapesquisa.png" placeholder="*******" />
                <img id="confirma_senha_func_img" src="~/Content/images/icon_chave.png" width="35px">

                <button @onclick="Submit" id="cadastre_func">Cadastrar</button>
            </div>
            </div>
            </div>


@code{

    public string Erro ="";
    public string Sucesso ="";
    public bool ShowSuccessMessage { get; set; }

  public RegisterFuncionario Input {get; set;} = new();

  public class RegisterFuncionario{
    public string Filme;
    public string Data;
    public string Horario;
    public string qtsingresso;
    public string Salasessao;

    
  }

  public async Task Submit(){
      Console.WriteLine("Test");
      var client = ClientFactory.CreateClient();

      
        using StringContent jsonContent = new(
            JsonSerializer.Serialize(new
            {
                idMovie = Input.Filme,
                dateSession = Input.Data,
                timeSession = Input.Horario,
                tickets = Input.qtsingresso,
                sessionRoom = Input.Salasessao,
               
            }),
            Encoding.UTF8,
            "application/json");

      

        Console.WriteLine($"teste => {jsonContent}");

       
       var response = await client.PostAsync("https://framming-api.onrender.com/session/211", jsonContent);
      
        var errorMessage = await response.Content.ReadAsStringAsync();
        Console.WriteLine($"Error: {errorMessage}");

  }

}


