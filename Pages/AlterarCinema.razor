@page "/AlterarCinema/{cinemaid}"
@using System;
@using Newtonsoft.Json;
@using System.Net.Http;
@using System.Text;
@using System.Threading.Tasks;

@inject IHttpClientFactory ClientFactory

<PageTitle>Alterar Cinema</PageTitle>
<body>

<style>
 @@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
 /* Outros estilos */
</style>

<div class="container_pesquisa">
  <button id="button_home">
    <a href="ferqyfq.html">
      <img src="/images/icon_home.png">
    </a>
  </button>

  <button id="button_notificacao">
    <a href="ferqyfq.html">
      <img src="/images/icon_notificacao.png">
    </a>


  </button>

  <div id="div_identificacao">
    <img src="/images/Chagasperfil.png">
    <p>Beatriz Chagas</p>
    <div id="div_indifica_role">
      <p>Linda</p>
    </div>
  </div>

  <div id="divBusca">
    <input type="text" id="txtBusca" img src="/images/lupapesquisa.png">
    <img id="imgBusca" src="/images/lupapesquisa.png" width="30px" alt="Buscar">
  </div>
</div>

<div class="container_menu_content">
  <div class="container_menu">
    <nav class="menu">
      <img id="framming_logo_menu" src="/images/framminglogo.png" />
      <ul>
        <div class="menu_container">
                    <button id="button_cliente_menu">
                        <li><a href="ListaFuncionarios"><img src="/images/icon_cliente.png"></a></li>
                    </button>
                    <button id="button_mensagens_menu">
                        <li><a href="Verpostadm"><img src="/images/icon_mensagens.png"></a></li>
                    </button>
                    <button id="button_identificacao_menu">
                        <li><a href="ListaUsuarios"><img src="/images/icon_identificacao.png"></a></li>
                    </button>
                    <button id="button_theater_menu">
                        <li><a href="ListaCinemas"><img src="/images/theater.png"></a></li>
                    </button>
                </div>
      </ul>
      <ul>
        <div class="buttons_sair_configuracao">
          <button id="button_sair_menu">
            <li><a href="#"><img src="/images/icon_saida.png"></a></li>
          </button>
          <button id="button_configuracao_menu">
            <li><a href="#"><img src="/images/configuracao.png"></a></li>
          </button>
        </div>
      </ul>
    </nav>

  </div>
  <div class="container_content">
    <div class="container_main">
      <div class="codigo_cinema">
        <img id="foto_codigo_func" src="/images/icon_identifica_func.png" />
        <p id="cod_cinema_p">Localidade: @Input.enderecoCinema</p>
        <p id="cod_nome_p">Nome: @Input.nomeCinema</p>
        <p id="cod_email_p">Salas: @Input.qtdSala</p>
         <p id="cod_codigo_p">Código: @Input.tokenCinema</p>
        

      </div>

      <p id="codigo_cadastro_func_p">Alterar cinema</p>


      <p id="codigo_func_p">Localidade:</p>
      <p id="codigo_func_result"></p>
      <input @bind="@Input.enderecoCinema" id="codigo_func"  type="text" placeholder="Av. Guimarães, N°12">
      <img id="codigo_func_img" src="/images/icon_local.png" width="35px" />

      <p id="codigo_nome_p">Nome:</p>
      <p id="codigo_nome_result"></p>
      <input @bind="@Input.nomeCinema"id="nome_func" type="text" placeholder="Uci Cinemas" />
      <img id="nome_func_img" src="/images/icon_theater.png" width="35px" />

      <p id="codigo_email_p">Número de Salas :</p>
      <p id="codigo_email_result"></p>
      <input @bind="@Input.qtdSala"id="email_func" type="text" placeholder="10" />
      <img id="email_func_img" src="/images/icon_numsalas.png" width="35px" />

      <p id="codigo_senha_p">Código Cinema:</p>
      <p id="codigo_senha_result"></p>
      <input @bind="@Input.tokenCinema" id="senha_func" type="text" disabled/>
      <img id="senha_func_img" src="/images/icon_chave.png" width="35px">


      <input type="file" id="fileInput" style="display: none;" accept="image/*" />
      <button id="choose_img" onclick="openFileExplorer()" style="background: none; border: none; cursor: pointer;">
        <img src="/images/foto_cadastro_func.png" id="imagePreview" />
      </button>

      <button @onclick="Update" id="cadastre_func">Alterar</button>
    </div>
  </div>
</div>
@if (ShowMessage2)
{
   <div class="succes_message2"></div>
}

@if (ShowMessage)
{

 <div class="succes_message"><p>Cinema Alterado com Sucesso!</p>
  <button class="button_succes"><a href="ListaCinemas"><img src="/images/theater.png"></a>x</button>
 </div>
 
}
</body>

@code{

   public inputModel Input {get; set;} = new();
    public class inputModel{
    public string enderecoCinema;
    public string nomeCinema;
    public string qtdSala;
    public string tokenCinema;
   

  }
    bool ShowMessage = false;
   bool ShowMessage2 = false;
  [Parameter]
   public string cinemaid { get; set;}

    protected override async Task OnInitializedAsync()
    {

    var client = ClientFactory.CreateClient();
    HttpResponseMessage response = await client.GetAsync($"https://framming-api.onrender.com/cinema/{cinemaid}");
    response.EnsureSuccessStatusCode();
    string responseBody = await response.Content.ReadAsStringAsync();

    Input = JsonConvert.DeserializeObject<inputModel>(responseBody);
    }

   public async Task Update(){
      Console.WriteLine("Test");
      var client = ClientFactory.CreateClient();

      
        using StringContent jsonContent = new(
           JsonConvert.SerializeObject(new
            {
                addressCinema = Input.enderecoCinema,
                nameCinema = Input.nomeCinema,
                numRooms = int.Parse(Input.qtdSala),
                codCinema = (Input.tokenCinema),
            
            }),
            Encoding.UTF8,
            "application/json");
              

        Console.WriteLine($"teste => {jsonContent}");

         var response = await client.PostAsync("https://framming-api.onrender.com/cinema", jsonContent);
       if (response.IsSuccessStatusCode)
 {
       ShowMessage = true;
        ShowMessage2 = true;
 }
 else
 {
     var errorMessage = await response.Content.ReadAsStringAsync();
     Console.WriteLine($"Error: {errorMessage}");
 }
}
}